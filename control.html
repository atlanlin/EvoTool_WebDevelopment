<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="style.css">
	<title>Barcode Reader</title>
	<script src="jquery.js"></script>
	<script src="evt.js"></script>
    <script src="camset.js"></script>
	<style>
		#logo{
			width:100px;
			float:right;
			
		}
		#toolSelectionForm{
			border-style:solid;
			border-width:3px;
			background-color:#81A594;
			width: 300px;
			float:left;
		}
		input[type="radio"]{
			margin-left: 20px;
		}
		#imageRegion{
			border-style:solid;
			border-width:3px;
			background-color:#81A594;
			margin-left:320px;
		}
		#imgView{
			margin-left: auto;
			margin-right:auto;
			display: block;
			height:690px;
		}
		textarea{
			margin: 15px;
			width:90%;
			font-size:12px;
		}
	</style>
	
</head>

<body>
	
	<div id="toolSelectionForm"> 
		<p style="margin:10px;"><b>Results</b></p>
		<textarea id="showResults" rows="12" ></textarea><br>
		<input class="button" type="button" id="btnClear" value="Clear"/>
		<input class="button" type="button" onClick="location.href='index.htm'" value="Main Menu"/><br><br>
		
		<label><b>Measured Items</b></label>
		<select id="viewToolDb">
		</select><br>
		<input type="button" id="btnView" value="View" class="button"/>
		
		<hr>
		
		<label><b>Select Measure Tool</b></label><br>
			<input type="radio" name="selectedTool" value="circle" checked>EVO Circle</input><br>
			<input type="radio" name="selectedTool" value="width">EVO Width</input><br>
			<input type="radio" name="selectedTool" value="ptp">EVO Distance (Point To Point)</input><br>
			<input type="radio" name="selectedTool" value="ptl">EVO Distance (Point To Line)</input><br>
			<input type="radio" name="selectedTool" value="ptc">EVO Distance (Point To Circle)</input><br>
			<input type="radio" name="selectedTool" value="ctl">EVO Distance (Circle To Line)</input><br>
			<input type="radio" name="selectedTool" value="ctc">EVO Distance (Circle To Circle)</input><br>
		<br>
		<label><b>Tool Number</b></label>
		<select id="selectedNumber">
		  <option value="1">Tool 1</option>
		  <option value="2">Tool 2</option>
		  <option value="3">Tool 3</option>
		  <option value="4">Tool 4</option>
		  <option value="5">Tool 5</option>
		  <option value="6">Tool 6</option>
		  <option value="7">Tool 7</option>
		  <option value="8">Tool 8</option>
		  <option value="9">Tool 9</option>
		</select><br>
		<input type="button" id="btnGo" value="Select" class="button"/>
		
		<p></p>
		
	</div>
	
	<div id="imageRegion">
		<img id="imgView"/>
	</div>
	<script>
		var cookieNames = ["circle", "width", "ptp", "ptl", "ptc", "ltc", "ctc", "ctl"];
		var displayNames = ["EVO Circle Tool", "EVO Width Tool", "EVO Distance (Point to Point) Tool", "EVO Distance(Point to Line) Tool", 
			"EVO Distance (Point to Circle) Tool", "EVO Distance (Line to Circle) Tool", "EVO Distance (Circle to Circle) Tool", "EVO Distance (Circle to Line) Tool"];
	
		window.onload = function() {
			displayResults();
			addItemsIntoDb();
			//displayResultsFromCookies();
			//addItemsIntoDbFromCookies();
			loadScreenshot();
			disableAllFunctions();
			setCalibrationFromCookie();
			
			
			document.getElementById("btnView").addEventListener("click", loadScreenshot);
			document.getElementById("btnClear").addEventListener("click", function(){
				
				for(var i = 0; i < cookieNames.length; i++){
					for(var j = 1; j < 10; j++){
						if(getCookie(cookieNames[i]+String(j)) != null)
						{
							deleteCookie(cookieNames[i]+String(j));
						}
						
					}
				}
				
				displayResults();
				addItemsIntoDb();
				localStorage.clear();
				loadScreenshot();
				$('#imgView').attr('src', '');
				
			});
			
			document.getElementById("btnGo").addEventListener("click", function(){
				var tool = getValueByName("selectedTool");
				var toolNo = document.getElementById("selectedNumber").value;
				var requestedPage;
				switch(tool){
					case "circle":
						requestedPage="circlewidth.htm?";
						break;
					case "width":
						requestedPage="width.html?";
						break;
					case "ptp":
						requestedPage="p_to_p.html?";
						break;
					case "ptl":
						requestedPage="p_to_l.html?";
						break;
					case "ptc":
						requestedPage="p_to_c.htm?";
						break;
					case "ctl":
						requestedPage="l_to_c.htm?";
						break;
					case "ctc":
						requestedPage="c_to_c.htm?";
						break;
					default:
						requestedPage="";
				}
				
				var queryString = requestedPage + "tool=" + tool + "&toolNo=" + toolNo;
				window.location.href = queryString;
			});
			
			
		}
		
		
		function getValueByName(elementName){
			var radioGroup = document.getElementsByName(elementName);
			for (var i=0; i<radioGroup.length; i++)  {
			   if (radioGroup[i].checked)  {
					return radioGroup[i].value;
			   }
			}
			return null;
		}
		
		function loadScreenshot(){
			if(typeof(Storage) !== "undefined") {
			
				var db = document.getElementById("viewToolDb");
				var tool = db.options[db.selectedIndex].value;
				if(tool == "none")
					return;
				var dataURL = localStorage.getItem("shot" + tool);
				document.getElementById("imgView").src=dataURL;
			} else {
				alert("Sorry! No Web Storage support..");
			}
		}
		
		/*function loadResults()
		{
		
			var strResult = ""; 
			var cookieNames = ["circle", "width", "ptp", "ptl", "ptc", "ltc", "ctc"];
			for(var i = 0; i < cookieNames.length; i++){
				for(var j = 1; j < 3; j++){
					if(getCookie(cookieNames[i]+String(j)) != null)
					{
						strResult += cookieNames[i]+String(j) + " : " +getCookie(cookieNames[i]+String(j)) +"\n";
						
					}
					else
					{
						strResult += cookieNames[i]+String(j) + " : 0 \n";
					}
				}
			}
			//alert(strResult);
			document.getElementById("showResults").value = strResult;
		
		}*/
		
		function removeOptions(selectbox)
		{
			var i;
			for(i=selectbox.options.length-1;i>=0;i--)
			{
				selectbox.remove(i);
			}
		}
		
		function addItemsIntoDb(){
			
			removeOptions(document.getElementById("viewToolDb"));
			
			
			var ca = document.cookie.split("; ");
			var ta = [];
			var taValue = [];
			var n = 0;
			
			ca = ca.sort();
			for (var i=0;i<ca.length;i++) {
				if (ca[i].substring(0,6) == "circle") {
					ta[n] = "EVO Circle Tool " + ca[i].substring(6,7);
					taValue[n] = ca[i].substring(0,7);
				}
				else if (ca[i].substring(0,5) == "width") {
					ta[n] = "EVO Width Tool " + ca[i].substring(5,6);
					taValue[n] = ca[i].substring(0,6);
				}
				else if (ca[i].substring(0,3) == "ptp") {
					ta[n] = "EVO Distance (Point to Point) Tool " + ca[i].substring(3,4);
					taValue[n] = ca[i].substring(0,4); 
				}
				else if (ca[i].substring(0,3) == "ptl") {
					ta[n] = "EVO Distance (Point to Line) Tool " + ca[i].substring(3,4);
					taValue[n] = ca[i].substring(0,4);
				}
				else if (ca[i].substring(0,3) == "ptc") {
					ta[n] = "EVO Distance (Point to Circle) Tool " + ca[i].substring(3,4); 
					taValue[n] = ca[i].substring(0,4);
				}
				else if (ca[i].substring(0,3) == "ctc") {
					ta[n] = "EVO Distance (Circle to Circle) Tool " + ca[i].substring(3,4);
					taValue[n] = ca[i].substring(0,4);
				}
				else if (ca[i].substring(0,3) == "ctl") {
					ta[n] = "EVO Distance (Circle to Line) Tool " + ca[i].substring(3,4);
					taValue[n] = ca[i].substring(0,4);
				}
				else {
					n--;
				}
				n++;
			}
			
			var viewTool = document.getElementById('viewToolDb');
			
			
			for(var j=0; j < ta.length; j++){
				viewTool.options[viewTool.options.length] = new Option(ta[j], taValue[j]);
			}
			
			var length = viewTool.length;
			if(length ==0)
				viewTool.options[viewTool.options.length] = new Option("No records", "none");
			
		}
		
		
		
		function displayResults() {
			var ca = document.cookie.split("; ");
			var ta = [];
			var n = 0;
			ca = ca.sort();
			for (var i=0;i<ca.length;i++) {
				if (ca[i].substring(0,6) == "circle") {
					ta[n] = "EVO Circle Tool " + ca[i].substring(6,7) + " = " + ca[i].substring(8,ca[i].length);  
				}
				else if (ca[i].substring(0,5) == "width") {
					ta[n] = "EVO Width Tool " + ca[i].substring(5,6) + " = " + ca[i].substring(7,ca[i].length);  
				}
				else if (ca[i].substring(0,3) == "ptp") {
					ta[n] = "EVO Distance (Point to Point) Tool " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);  
				}
				else if (ca[i].substring(0,3) == "ptl") {
					ta[n] = "EVO Distance (Point to Line) Tool " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);  
				}
				else if (ca[i].substring(0,3) == "ptc") {
					ta[n] = "EVO Distance (Point to Circle) Tool " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);  
				}
				else if (ca[i].substring(0,3) == "ctc") {
					ta[n] = "EVO Distance (Circle to Circle) Tool " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);  
				}
				else if (ca[i].substring(0,3) == "ctl") {
					ta[n] = "EVO Distance (Circle to Line) Tool " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);  
				}
				else {
					n--;
				}
				n++;
			}
			
			
			document.getElementById("showResults").value = ta.join("\n");
		}
		
			
		/*
		function displayResultsFromCookies(){
			var ca = document.cookie.split("; ");
			var ta = [];
			var n = 0;
			
			ca = ca.sort();
			for (var i=0;i<ca.length;i++) {
				var cookieIndex = $.inArray(ca[i].substring(0,3), cookieNames);
				if(cookieIndex >= 0){
					ta[i] = displayNames[i] + " " + ca[i].substring(3,4) + " = " + ca[i].substring(5,ca[i].length);
				}
					
			}
			
			
			document.getElementById("showResults").value = ta.join("\n");
			
		}
		
		function addItemsIntoDbFromCookies(){
			
			var ca = document.cookie.split("; ");
			var ta = [];
			var taValue = [];
			var n = 0;
			
			ca = ca.sort();
			for (var i=0; i<ca.length; i++) {
				var cookieIndex = $.inArray(ca[i].substring(0,3), cookieNames);
				if(cookieIndex >= 0){
					ta[i] = displayNames[i] + " " + ca[i].substring(3,4);
					taValue[i] = cookieNames[cookieIndex] + a[i].substring(3,4);
				}
			}
			alert('hi');
			
			var viewTool = document.getElementById('viewToolDb');
			var length = viewTool.options.length;
			for (var i = 0; i < length; i++) {
			  viewTool.options[i] = null;
			}
			
			for(var j=0; j < ta.length; j++){
				viewTool.options[viewTool.options.length] = new Option(ta[j], taValue[j]);
			}
			
			length = viewTool.options.length;
			if(length ==0)
				viewTool.options[viewTool.options.length] = new Option("No records", "none");
		}
		
		function getValueofDb(){
			
		}
		
		*/
	</script>
	
</body>
</html>